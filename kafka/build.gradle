
ext {
    platformHostIP = getHostIP()
    platformHostType = getHostType()
}

def getHostType() {
    String hostType = System.getenv("PLATFORM_HOST_TYPE")
    if(hostType == null || hostType.isEmpty()) {
        hostType = "rhel";
    }
    return hostType;
}
def getHostIP() {
    java.net.InetAddress inetAddress = java.net.InetAddress.localHost;
    println "inetAddress = $inetAddress.hostAddress";
    return inetAddress.hostAddress;
}
task startDocker(type: Exec) {
    environment("PLATFORM_HOST_IP", "${platformHostIP}")
    environment("COMPOSE_PROJECT_NAME", "${project.name}")
    environment("namespace", "${namespace}")
    executable 'bash'
    args '-c', "docker-compose -f ${projectDir}/src/main/resources/${platformHostType}/docker-compose.yml up -d"
}

task stopDocker(type: Exec) {
    environment("COMPOSE_PROJECT_NAME", "${project.name}")
    environment("namespace", "${namespace}")
    executable 'bash'
    args '-c', "docker-compose -f ${projectDir}/src/main/resources/${platformHostType}/docker-compose.yml down"
}

