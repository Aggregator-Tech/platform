ext {
    repository="$project.name".toLowerCase()
    tag="$version"
}

task publish(type: Exec) {
    dependsOn installDist
    executable 'sh'
    args '-c', "docker build -t=${namespace}/${repository}:${tag} ."
}

task publishToDockerHub(type: Exec) {
    environment("COMPOSE_PROJECT_NAME", "${project.name}")
    environment("namespace", "${namespace}")
    environment("repository", "${repository}")
    environment("tag", "${tag}")
    environment("servicePort", "${servicePort}")
    executable 'bash'
    args '-c', "docker-compose -f ${projectDir}/src/main/resources/docker-compose.yml up -d"
}

task publishToArtifactory(type: Exec) {
    environment("COMPOSE_PROJECT_NAME", "${project.name}")
    environment("namespace", "${namespace}")
    environment("repository", "${repository}")
    environment("tag", "${tag}")
    environment("servicePort", "${servicePort}")
    executable 'bash'
    args '-c', "docker-compose -f ${projectDir}/src/main/resources/docker-compose.yml down"
}
