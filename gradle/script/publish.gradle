ext {
    repository="$project.name".toLowerCase()
    tag="$version"
}

task publishD(type: Exec) {
    //do nothing, will let projects decide whether to publish to docker hub, artifactory or custom place
}

task publishToDockerHub(type: Exec) {
    
    environment("COMPOSE_PROJECT_NAME", "${project.name}")
    environment("namespace", "${namespace}")
    environment("repository", "${repository}")
    environment("tag", "${tag}")
    environment("servicePort", "${servicePort}")
    executable 'bash'
    args '-c', "docker login -u aggregatortech -p Westworld@1;docker push aggregatortech/${repository}"

}

task publishToArtifactory(type: Exec) {
    environment("COMPOSE_PROJECT_NAME", "${project.name}")
    environment("namespace", "${namespace}")
    environment("repository", "${repository}")
    environment("tag", "${tag}")
    environment("servicePort", "${servicePort}")
    executable 'bash'
    args '-c', "docker-compose -f ${projectDir}/src/main/resources/docker-compose.yml down"
}
